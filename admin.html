<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin ‚Äì SARM</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background:#f5f5f5;
      padding:20px;
    }
    h2 { text-align:center; }
    .order {
      background:#fff;
      padding:15px;
      margin-bottom:15px;
      border-radius:8px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    input, button, select {
      padding:10px;
      width:100%;
      margin-top:10px;
    }
    #loginBox {
      max-width:320px;
      margin:100px auto;
      background:#fff;
      padding:20px;
      border-radius:8px;
    }
    .hidden { display:none; }
  </style>
</head>
<body>

<!-- üîê LOGIN -->
<div id="loginBox">
  <h3>Admin Login</h3>
  <input id="email" type="email" placeholder="Admin Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- üì¶ ADMIN PANEL -->
<div id="adminPanel" class="hidden">
  <h2>üì¶ SARM Orders Dashboard</h2>
  <button onclick="logout()">Logout</button>
  <div id="orders"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // üî• Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyB2bfLiik96iccPzM3v7dz-Tc-S_4R4pHc",
    authDomain: "sarm-spiral-notebooks.firebaseapp.com",
    projectId: "sarm-spiral-notebooks",
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();

  const loginBox = document.getElementById("loginBox");
  const adminPanel = document.getElementById("adminPanel");
  const ordersDiv = document.getElementById("orders");

  // üîê AUTH STATE
  auth.onAuthStateChanged(user => {
    if (user) {
      loginBox.style.display = "none";
      adminPanel.classList.remove("hidden");
      loadOrders();
    } else {
      loginBox.style.display = "block";
      adminPanel.classList.add("hidden");
    }
  });

  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    auth.signInWithEmailAndPassword(email, password)
      .catch(err => alert(err.message));
  }

  function logout() {
    auth.signOut();
  }

  // üì¶ LOAD ORDERS
  function loadOrders() {
    db.collection("orders")
      .orderBy("createdAt", "desc")
      .onSnapshot(snapshot => {
        ordersDiv.innerHTML = "";
        snapshot.forEach(doc => {
          const o = doc.data();
          const div = document.createElement("div");
          div.className = "order";

          div.innerHTML = `
            <strong>Order ID:</strong> ${doc.id}
            <strong>Name:</strong> ${o.customer.name}
            <strong>Phone:</strong> ${o.customer.phone}
            <strong>Address:</strong> ${o.customer.address}
            <strong>Payment:</strong> ${o.paymentMethod}
            <strong>Total:</strong> Rs ${o.total}

            <strong>Status:</strong>
            <select onchange="updateStatus('${doc.id}', this.value)">
              <option ${o.status==="Pending"?"selected":""}>Pending</option>
              <option ${o.status==="Shipped"?"selected":""}>Shipped</option>
              <option ${o.status==="Delivered"?"selected":""}>Delivered</option>
            </select>
          `;
          ordersDiv.appendChild(div);
        });
      });
  }

  // üîÑ STATUS UPDATE + WHATSAPP
  function updateStatus(orderId, newStatus) {
    db.collection("orders").doc(orderId).get().then(doc => {
      const o = doc.data();

      db.collection("orders").doc(orderId).update({
        status: newStatus
      });

      const msg = `
üì¶ Order Update ‚Äì SARM Spiral Notebooks

Hello ${o.customer.name},
Your order is now:
‚û°Ô∏è ${newStatus}

Thank you üôè
      `;

      window.open(
        `https://wa.me/91${o.customer.phone}?text=${encodeURIComponent(msg)}`,
        "_blank"
      );
    });
  }
</script>

</body>
</html>
